{% extends '::base.html.twig' %}

{% block title web_title %}

{% block body %}
    <div class="container">
        <div class="row">
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                    <div class="row">
                        <div class="navbar-header col-sm-6">
                            <button type="button" class="btn visible-xs pull-right" onClick="this.className = 'hidden';document.getElementById('searchForm').className = 'navbar-form navbar-right'; document.getElementById('searchInput').focus()"><i class="fa fa-search fa-2x"></i></button>
                            
                            <a class="navbar-brand" href="/">{{ web_title }}</a>
                        </div>
                        
                        <div class="col-sm-6">
                            <form id="searchForm" class="navbar-form navbar-right hidden-xs" role="search" action="{{ path('ColectaSearch') }}" method="GET">
                                <div class="form-group">
                                    <input type="text" class="form-control" name="q" id="searchInput" value="{{ app.request.get('search') }}">
                                </div>
                                <button type="submit" class="btn btn-default">Buscar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </nav>
            
            {% if web_header_img | length %}
            <div class="col-xs-12 hidden-xs" style="background: url( {{ random(web_header_img) }} ) no-repeat center center; height:140px;background-size: cover;"></div>
            {% endif %}
        </div>
        
        <div class="row content">

            <div class="col-xs-12 col-md-9 main">

                {% if app.session.hasFlash('error') %}
                    <div class="alert alert-danger">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-exclamation fa-stack-1x fa-inverse"></i>
                        </span> 
                        
                        {{ app.session.flash('error') }}
                    </div>
                {% endif %}
                {% if app.session.hasFlash('success') %}
                    <div class="alert alert-success">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-square fa-stack-2x"></i>
                            <i class="fa fa-check fa-stack-1x fa-inverse"></i>
                        </span> 
                        
                        {{ app.session.flash('success') }}
                    </div>
                {% endif %}

                {% block article %}{% endblock %}
            </div>
            
            <div class="col-xs-12 col-md-3 sidebar">
                {% if app.user %}
                <div class="media self">
                    <a href="{{ path('userProfile', { 'id': app.user.id }) }}" class="pull-left">
                        <img src="{% if app.user.avatar %}{{ path('userAvatar',{'uid':app.user.id,'width':50,'height':50}) }}{% else %}/img/unknown.gif{% endif %}" width="50">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">{{ app.user.name }}</h4>
                        <div class="btn-group">
                            <a href="{{ path('userEditProfile') }}" class="btn btn-default btn-xs">Editar perfil</a>
                            <a href="{{ path('userLogout') }}" class="btn btn-default btn-xs" style="color:darkred;">Salir <span class="fa fa-sign-out"></span></a>
                        </div>
                    </div>
                </div>

                <hr>
                {% else %}
                <form class="login" action="{{ path('userLoginCheck') }}" method="post">
                    <p class="lead">Iniciar sesión</p>
                    
                    
                    <p class="input-group input-group-sm">
                          <span class="input-group-addon"><i class="fa fa-envelope"></i></span>
                          <input  type="email" required class="form-control" id="username" name="_username" placeholder="Email" value="" onFocus="if(this.value == 'Email') this.value=''">
                    </p>
                    
                    <p class="input-group input-group-sm">
                          <span class="input-group-addon"><i class="fa fa-key"></i></span>
                          <input type="password" required class="form-control" id="password" name="_password" class="input-medium" placeholder="Contraseña" value="" onFocus="if(this.value == 'Contraseña') this.value=''">
                    </p>
                    
                    <p><label for="remember_me">
                        <input id="remember_me" name="_remember_me" type="checkbox" checked /> Mantenerme conectado
                    </label></p>
                    
                    <button type="submit" name="login" class="btn btn-success btn-block btn-sm">Acceder</button>
                    <a href="{{ path('userResetPassword') }}" class="btn btn-block btn-link btn-xs">Olvidé mi contraseña</a>
                </form>
                <hr>
                
                <script>
                    var phitest = document.createElement('input');
                    if(!('placeholder' in phitest)) {
                        document.getElementById('username').value='Email';
                        document.getElementById('password').value='Contraseña';
                    }
                </script>
                {% endif %}

                <ul class="nav nav-pills nav-stacked">
                    <li class="">
                        <a href="/">
                            <i class="fa fa-home fa-fw"></i> Inicio 
                            {#<span class="badge pull-right">42</span>#}
                        </a>
                    </li>
                    {% if app.user %}
                    <li>
                        <a href="{{ path('ColectaChatIndex') }}">
                            <i class="fa fa-unlock-o fa-fw"></i> Privado
                        </a>
                    </li>
                    {% endif %}
                    {% if app.user and app.user.role.siteConfig %}
                    <li>
                        <a href="#">
                            <i class="fa fa-wrench fa-fw"></i> Configuración
                        </a>
                    </li>
                    {% endif %}
                </ul>
                
                <hr>
                
                {% if app.user %}
                    {% if item is defined %}
                        {% set notifications = colectauser.notDismissedNotifications(item.id) %}    
                    {% else %}
                        {% set notifications = colectauser.notDismissedNotifications %}
                    {% endif %}
                    
                    {% set messages = colectauser.notDismissedMessages %}
                    
                <ul class="nav nav-pills nav-stacked">
                    <li>
                        <a href="{{ path('userNotifications')}}"><i class="fa fa-bullhorn fa-fw"></i> Notificaciones{% if notifications | length > 0 %} <span class="badge pull-right">{{ notifications | length }}</span>{% endif %}</a>
                    </li>
                    <li>
                        <a href="{{ path('userMessages')}}"><i class="fa fa-envelope fa-fw"></i> Mensajes{% if messages | length > 0 %} <span class="badge pull-right">{{ messages | length }}</span>{% endif %}</a>
                    </li>
                </ul>
                {% else %}
                <ul class="nav nav-pills nav-stacked">
                    <li>
                        <a href="{{ path('ColectaContact') }}"><i class="fa fa-envelope-o fa-fw"></i> Contacto</a>
                    </li>
                    <li>
                        <a href="{{ path('ColectaPostView', {'slug':'acerca-de-nosotros'}) }}"><i class="fa fa-info fa-fw"></i> Acerca de nosotros</a>
                    </li>
                    <li>
                        <a href="{{ path('ColectaPostView', {'slug':'por-que-hacerse-socio'}) }}"><i class="fa fa-question fa-fw"></i> Por qué hacerse socio</a>
                    </li>   
                </ul>
                {% endif %}
                
                <hr>
                
                {# hide when big calendar is shown #}
                {% if app.request.attributes.get("_controller") != 'Colecta\\ActivityBundle\\Controller\\EventController::indexAction' and app.request.attributes.get("_controller") != 'Colecta\\ActivityBundle\\Controller\\EventController::dateAction' %}
                {% render "ColectaActivityBundle:Event:calendar" with {'date':'today'} %}
            {% endif %}
            </div>
        </div>
    </div>             
{% endblock %}