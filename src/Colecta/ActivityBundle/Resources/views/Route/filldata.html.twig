{% extends '::frontend.html.twig' %}

{% block routes 'active' %}
{% block onload 'initialize()' %}
{% block javascripts %}
    
    {% set boundsswlat, boundsswlng = track[0].latitude, track[0].longitude %}
    {% set boundsnelat, boundsnelng = track[0].latitude, track[0].longitude %} 
    {% set points = '[' ~ track[0].latitude ~ ',' ~ track[0].longitude ~ ']' %}
    
    {% for tp in track %}
        {% if not loop.first %}
            {% set points = points ~ ',[' ~ tp.latitude ~ ',' ~ tp.longitude ~ ']' %}
            {% if tp.latitude < boundsswlat %}{% set boundsswlat = tp.latitude %}{% endif %}
            {% if tp.longitude < boundsswlng %}{% set boundsswlng = tp.longitude %}{% endif %}
            {% if tp.latitude > boundsnelat %}{% set boundsnelat = tp.latitude %}{% endif %}
            {% if tp.longitude > boundsnelng %}{% set boundsnelng = tp.longitude %}{% endif %}
        {% endif %}
    {% endfor %}
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script>
    
    var map;
    var polyline = [];
    var points = [{{ points }}];
    var bounds = new google.maps.LatLngBounds(new google.maps.LatLng({{ boundsswlat }}, {{ boundsswlng }}), new google.maps.LatLng({{ boundsnelat }}, {{ boundsnelng }}));
    
    function initialize() {   
        
        var mapOptions = {
            zoom: 3,
            center: bounds.getCenter(),
            mapTypeId: google.maps.MapTypeId.TERRAIN, 
            streetViewControl: false
        };
        
        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        map.fitBounds(bounds);
        
        $.each(points, function(index, value) { 
            polyline.push(new google.maps.LatLng(value[0], value[1]));
        });
        
        var path = new google.maps.Polyline({
            path: polyline,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
        });
        
        path.setMap(map);
    }
    
    </script>
    
{% endblock %}
{% block article %}

<div id="map" class="full"></div>

<form action="{{ path('ColectaRouteUpload') }}" method="POST" class="form-horizontal well">
<h2>Datos de la Ruta</h2>
    <fieldset>
      <div class="control-group">
        <label class="control-label" for="RouteFile">Archivo</label>
        <div class="controls">
          <input type="file" id="RouteFile" name="file">
        </div>
      </div>
      {{ filename }}
    
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Subir e introducir datos</button>
      </div>
    </fieldset>
</form>

{% endblock %}