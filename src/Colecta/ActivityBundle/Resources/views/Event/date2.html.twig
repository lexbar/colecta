{% extends '::frontend.html.twig' %}

{% block events 'active' %}

{% block article %}

<div class="title-block">
    {% if app.user %} <a href="{{ path('ColectaEventNew') }}" class="btn btn-small pull-right btn-primary">Crear evento <i class="icon-plus"></i></a> {% endif %}
    <h2>
    {% if ismonth %}
        {% include "::month.html.twig" with {'date': date, 'short':0} %}
    {% else %}
        {{ date | date('j')  }} de {% include "::month.html.twig" with {'date': date, 'short':0} %} 
    {% endif %}
    </h2>
</div>

<div class="bigcalendar">
{% render "ColectaActivityBundle:Event:calendar" with {'date':date | date('Y/n/j')} %}
</div>


{% for item in items %}
    
    <div class="event micro{% if item.happened %} happened{% endif %}">

    <div class="date">
        <span class="weekday">{{ item.dateini | date('l') | replace ({
            'Monday':'Lunes',
            'Tuesday':'Martes',
            'Wednesday':'Miércoles',
            'Thursday':'Jueves',
            'Friday':'Viernes',
            'Saturday':'Sábado',
            'Sunday':'Domingo'
        }) }}</span>
        <span class="monthday">{{ item.dateini | date('d') }}</span> 
        <span class="month">{% include '::month.html.twig' with{'date':item.dateini,'short':1} %}{% if item.dateini | date('Y') != 'today' | date('Y') %} '{{ item.dateini | date('y') }}{% endif %}</span>
        <span class="hour">{{ item.dateini | date('H:i') }}</span>
    </div>
    
    <div class="datum">
        <h2><a href="{{ path('ColectaEventView', { 'slug': item.slug }) }}">{{ item.name }}</a> <small>de {{ item.author.name }}</small></h2>
        
        <ul class="properties">
            {% if item.distance > 0%}
            <li{% if item.distance > 999 %} class="small"{% endif %}>Distancia: <strong>{{ item.distance }} km</strong></li>
            {% endif %}
            
            {% if item.uphill > 0%}
            <li{% if item.uphill > 999 %} class="small"{% endif %}>Subida: <strong>{{ item.uphill }} m</strong></li>
            {% endif %}
            
            {% if item.type != 'Activity/Event' and item.downhill > 0%}
            <li{% if item.downhill > 999 %} class="small"{% endif %}>Bajada: <strong>{{ item.downhill }} m</strong></li>
            {% endif %}
            
            {% if item.time > 0%}
                {% set secconds, minutes, hours, days = 0, 0, 0, 0 %}
                {% if item.time < 60 %}
                    {% set secconds = item.time %}
                {% else %}
                    {% set minutes = item.time // 60 %}
                    {% set secconds = item.time - minutes * 60 %}
                    
                    {% if minutes >= 60 %}
                        {% set hours = minutes // 60 %}
                        {% set minutes = minutes - hours * 60 %}
                        
                        {% if hours >= 24 %}
                            {% set days = hours // 24 %}
                            {% set hours = hours - days * 24 %}
                        {% endif %}
                    {% endif %}
                {% endif %}
                <li{% if item.time >= 86400 %} class="small"{% endif %}>Duración: <strong>{% if days > 0 %}{{ days }}d {% endif %}{{ hours }}h {{ minutes }}m</strong> </li>
            {% endif %}
            {% if item.difficulty != '' %}
            <li>Dificultad: <strong>{% set difficulty = item.difficulty | replace({'easy':'fácil', 'moderate':'moderado', 'hard':'difícil', 'very hard':'muy difícil', 'experts only':'sólo expertos'}) %}{{ difficulty }}</strong> </li>
            {% endif%}
        </ul>
    </div>
    
</div>
        
{% else %}
    
    <div class="alert alert-info">
        No hay ningún evento en esta fecha.
    </div>

{% endfor %}


{% endblock %}