{% extends '::frontend.html.twig' %}

{% block title %}Actividades{% endblock %}

{% block article %}

{% if app.user %} <a href="{{ path('ColectaEventNew')}}" class="btn btn-small btn-primary pull-right">Nueva publicación <i class="fa fa-plus"></i></a> {% endif %}
<h2>
{% if ismonth %}
    Actividades en {% include "::month.html.twig" with {'date': date, 'short':0} %}
{% else %}
    Actividades el {{ date | date('j')  }} de {% include "::month.html.twig" with {'date': date, 'short':0} %} 
{% endif %}
</h2>

<div class="bigcalendar">
{{ render(controller('ColectaActivityBundle:Event:calendar', {'date':date | date('Y-m-d')})) }}
</div>

{% set panelHappenedOpen = 0 %}

{% if items | length > 0 and items[0].happened %}
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Actividades pasadas</h3>
    </div>
    <div class="panel-body">
    
    {% set panelHappenedOpen = 1 %}
{% endif %}

{% for item in items %}
    {% if item.happened %}
        {% set path = 'Colecta' ~ item.type ~ ':micro.html.twig' %}
        {% set path = path | replace({'/':'Bundle:'}) %}
        {% include path with { 'item': item } only %}
    {% else %}  
        {% if panelHappenedOpen %}
            </div></div>
            {% set panelHappenedOpen = 0 %}
        {% endif %}      
        {% set path = 'Colecta' ~ item.type ~ ':mini.html.twig' %}
        {% set path = path | replace({'/':'Bundle:'}) %}
        {% include path with { 'item': item } only %}
        {% include 'ColectaItemBundle:Default:related.html.twig' with { 'items' : item.relatedVisible(app.user) } %} 
    {% endif %}
{% endfor %}

{% if panelHappenedOpen %}
    </div></div>
    {% set panelHappenedOpen = 0 %}
{% endif %}    

<div class="alert alert-blank text-center" role="alert"><strong>Puedes suscribirte</strong> al calendario usando Outlook, iCal, Google Calendar, etc... <a href="{{ path('ColectaEventAboutics')}}">Saber más <i class="fa fa-angle-double-right"></i>.</a></div>

{% endblock %}