{% extends '::frontend.html.twig' %}

{% block title %}Inicio{% endblock %}

{% block article %}

{% include '::navigation.html.twig' with {'active': ''} %}

    <h2>Inicio{% if page > 1 %} <small>página {{page}}</small>{% endif %}</h2>

    {% if app.user and 0 %}
        <form id="itemSubmit" class="form-horizontal" enctype="multipart/form-data" method="POST" action="{{ path('ColectaPostCreate') }}">
            <div class="mainData">
                <input id="itemSubmitName" type="text" name="name" class="title" placeholder="Título">
                <textarea id="itemSubmitDescription" name="description" placeholder="Descripción" class="description"></textarea>
            </div>
            <div id="itemDetails"></div>
            <ul class="types unstyled">
                <li class="pull-left text">Publicar: </li>
                <li class="pull-left post" onClick="loadPostForm();"><i class="fa fa-file-text-o"></i> Texto</li>
                <li class="pull-left event" onClick="loadEventForm();"><i class="fa fa-calendar"></i> Actividad</li>
                <li class="pull-left route"> <input type="file" name="file" id="Route"><i class="fa fa-code-fork"></i> Ruta</li>
                <li class="pull-left place" onClick="loadPlaceForm();"><i class="fa fa-map-marker"></i> Lugar</li>
                <li class="pull-left file"> <input type="file" name="file[]" multiple="multiple" id="File"><i class="fa fa-folder-open"></i> Archivos</li>
                <li class="pull-left cancel"><button type="button" class="btn btn-small" onclick="cancelType()"><i class="fa fa-remove"></i> Cancelar</button></li>
                
                <li class="pull-right">
                    <button class="btn btn-small btn-primary" type="submit" id="itemSubmitButton">
                        <i id="itemSubmitButtonLoading"></i> 
                        <span id="itemSubmitButtonText">Publicar</span> 
                    </button>
                </li>
                <li class="pull-right category">{% render 'ColectaItemBundle:Category:formlist' with {'selected': 0, 'simplified': 1} %}</li>
            </ul>
        </form>
    {% endif %}

{#
{% set slv = app.session.get('sinceLastVisit') %}
{% if slv and colectauser.sinceLastVisitItems | length > 0 %}
    {% include 'ColectaItemBundle:Default:sincelastvisitcomments.html.twig' with {'items' : colectauser.sinceLastVisitItems, slv: slv} only %}
{% endif %}
#}

{% include 'ColectaItemBundle:Default:newItemForm.html.twig' %}

{% set shownItems = [] %}
{% set mainItemsToShow = [] %}

{% for item in items if not item.part %}
    {% set mainItemsToShow = mainItemsToShow | merge([item.id]) %}
{% endfor %}

{% for item in items if item.id not in shownItems %}
    {% if item.part %}
        {% for relitem in item.related %}
            {% if not relitem.part %}
                {% set item = relitem %}
            {% endif %}
        {% endfor %}
    {% endif %}
    <div class="item" id="item{{ item.id}}">        
        {% set path = 'Colecta' ~ item.type ~ ':mini.html.twig' %}
        {% set path = path | replace({'/':'Bundle:'}) %}
        {% include path with { 'item': item } only %}
        
        {% include 'ColectaItemBundle:Default:related.html.twig' with { 'items' : item.related } %}
    </div>
    
    {% set shownItems = shownItems | merge([item.id]) %}
    {% for ri in item.related %}
        {% set shownItems = shownItems | merge([ri.id]) %}
    {% endfor %}
{% else %}
    <p class="lead">Nadie ha publicado nada... por ahora.</p>
{% endfor %}

{% if page > 1 or thereAreMore %}
    <ul class="pager">
      <li class="previous{% if page == 1 %} disabled{% endif %}">
        <a href="{% if page > 1 %}{{ path('ColectaDashboardPage', {'page': page - 1 }) }}{% else %}{% endif %}">&larr; Anteriores</a>
      </li>
      <li class="next{% if not thereAreMore %} disabled{% endif %}">
        <a href="{% if thereAreMore %}{{ path('ColectaDashboardPage', {'page': page + 1 }) }}{% else %}{% endif %}">Siguientes &rarr;</a>
      </li>
    </ul>
{% endif %}

{% endblock %}