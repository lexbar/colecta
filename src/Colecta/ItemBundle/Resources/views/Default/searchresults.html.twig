{% extends '::frontend.html.twig' %}

{% block title %}{{ search }}{% endblock %}

{% block article %}
    
    <form id="searchForm" role="search" action="{{ path('ColectaSearch') }}" method="GET">
        <div class="inner-addon right-addon">
            <input type="text" class="form-control" name="q" id="searchInput" value="{{ app.request.get('q') }}" placeholder="Buscar...">
            <i class="fa fa-search" onClick="$('#searchForm').submit()"></i>
        </div>
    </form>

{% set shownItems = [] %}
{% set mainItemsToShow = [] %}

{% for item in items if not item.part %}
    {% set mainItemsToShow = mainItemsToShow | merge([item.id]) %}
{% endfor %}

{% for item in items if item.id not in shownItems %}
    {% if item.part %}
        {% for relitem in item.related %}
            {% if not relitem.part %}
                {% set item = relitem %}
            {% endif %}
        {% endfor %}
    {% endif %}     
        {% set path = 'Colecta' ~ item.type ~ ':mini.html.twig' %}
        {% set path = path | replace({'/':'Bundle:'}) %}
        {% include path with { 'item': item } only %}
    
    {% set shownItems = shownItems | merge([item.id]) %}
    {% for ri in item.related %}
        {% set shownItems = shownItems | merge([ri.id]) %}
    {% endfor %}
{% else %}
    <p class="lead">Vaya, no he encontrado nada con esas palabras.</p>
{% endfor %}

{% if page > 1 or thereAreMore %}
    <ul class="pager">
      <li class="previous{% if page == 1 %} disabled{% endif %}">
        <a href="{% if page > 1 %}{{ path('ColectaSearchPage', {'page': page - 1 }) }}?q={{ search}}{% else %}{% endif %}">&larr; Anteriores</a>
      </li>
      <li class="next{% if not thereAreMore %} disabled{% endif %}">
        <a href="{% if thereAreMore %}{{ path('ColectaSearchPage', {'page': page + 1 }) }}?q={{ search}}{% else %}{% endif %}">Siguientes &rarr;</a>
      </li>
    </ul>
{% endif %}

{% endblock %}




