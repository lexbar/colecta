{% set new = app.user and app.session.get('sinceLastVisit') and app.session.get('sinceLastVisit') != 'dismiss' and app.session.get('sinceLastVisit') < item.date %}

<div class="item panel {% if new %}panel-warning{% else %}panel-primary{% endif %}">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-{{ itemIcons[item.type] }}"></i> <a href="{{ path('ColectaFolderView', { 'slug': item.slug }) }}">{{ item.name }}</a></h3>
    </div>
    
    <div class="panel-body">
        <p class="details"><a href="{{ path('userProfile', { 'id': item.author.id }) }}" class="username"><img src="{% if item.author.avatar %}{{ path('userAvatar',{'uid':item.author.id,'width':40,'height':40}) }}{% else %}/img/unknown.gif{% endif %}"> {{item.author.name}}</a> {% include 'ColectaItemBundle:Default:timeago.html.twig' with { 'date': item.date } only %}{% if item.category %} en <a class="category" href="{{ path('ColectaCategoryView', { 'slug': item.category.slug }) }}">{{ item.category.name }}</a>{% endif %}</p>
        
        {% set files = item.isolateLast %}
        
        {% set thumbnails = 0 %} {% set listed = 0 %}
        {% for file in files %}
            {% if file.filetype in ['jpeg','gif','png'] %}  
                {% set thumbnails = thumbnails + 1 %}
            {% else %}
                {% set listed = listed + 1 %}
            {% endif %}
        {% endfor %}
        
        {% if thumbnails > 0 %}
        <div class="row thumbnails">        
            {% for file in files | reverse | slice(0,8) %}
                {% if file.filetype in ['jpeg','gif','png'] %}                    
                    <div class="col-xs-6 col-sm-3">
                        <a href="{{ path('ColectaFileView', { 'slug': file.slug }) }}"><img class="img-responsive" src="{{ path('ColectaFileThumbnail', {'slug':file.slug, 'width':200, 'height':200}) }}"></a>
                    </div>
                {% endif %}
            {% endfor %}
            
            {% if thumbnails == 1 or listed == 0 %}
            <p class="col-xs-12 col-sm-9">{{ item.summary | usercontent | raw | nl2br }}{% if item.text | length > item.summary | length %}<span id="linkrm-{{ item.slug }}"><button type="button" class="btn btn-link btn-small" onClick="document.getElementById('readmore-{{ item.slug }}').style.display = '';document.getElementById('linkrm-{{ item.slug }}').style.display = 'none';return false;">( ... leer más )</button></span> <span id="readmore-{{ item.slug }}" style="display:none">{{ item.text[item.summary|length:item.text|length -item.summary|length] | usercontent | raw | nl2br }} </span>{% endif %}</p>
            {% endif %}
        </div>
        {% endif %}
        
        {% if listed > 0 %}
        <ul class="list-group">
            {% for file in files %}
                {% if file.filetype not in ['jpeg','gif','png'] %}
                    <a href="{{ path('ColectaFileView', { 'slug': file.slug }) }}" class="list-group-item clearfix">
                    <strong>{{ file.name }}</strong>
                    <span class="btn btn-warning btn-xs pull-right"><span style="text-transform: uppercase;">{{ file.filetype }}</span></button>
                    </a>
                {% endif %}
            {% endfor %}
        </ul>
        {% endif %}
        
        {% if thumbnails != 1 or listed > 0 %}
        <p>{{ item.summary | usercontent | raw | nl2br }}{% if item.text | length > item.summary | length %}<span id="linkrm-{{ item.slug }}"><button type="button" class="btn btn-link btn-small" onClick="document.getElementById('readmore-{{ item.slug }}').style.display = '';document.getElementById('linkrm-{{ item.slug }}').style.display = 'none';return false;">( ... leer más )</button></span> <span id="readmore-{{ item.slug }}" style="display:none">{{ item.text[item.summary|length:item.text|length -item.summary|length] | usercontent | raw | nl2br }} </span>{% endif %}</p>
        {% endif %}
    </div>
    
    <div class="panel-footer">
        {% include 'ColectaItemBundle:Default:itemactions.html.twig' with { item: item } only %}
        
        {% include 'ColectaItemBundle:Comment:comments.html.twig' with { 'comments': item.comments, 'item': item, 'collapse': 5 } only %}
    </div>
</div>