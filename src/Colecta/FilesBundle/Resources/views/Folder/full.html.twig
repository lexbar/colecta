{% extends '::frontend.html.twig' %}

{% block title %}{{ item.name }} | Archivos{% endblock %}

{% block article %}

<div class="item panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            <a href="{{ path('ColectaFolderView', { 'slug': item.slug }) }}">{{ item.name }}</a>
            {% if app.user and item.canEdit(app.user) %}
                <a href="{{ path('ColectaFolderEdit', {slug:item.slug}) }}" class="pull-right" title="Editar"><i class="fa fa-pencil"></i> Editar</a>
            {% endif %}
        </h3>
    </div>
    
    <div class="panel-body">
        {% set files = item.isolateLast %}
        
        {% if files | length == 0 %}
            {% set files = item.files %}
        {% endif %}
        
        {% set thumbnails = 0 %} {% set listed = 0 %}
        {% for file in files %}
            {% if file.filetype in ['jpeg','gif','png'] %}  
                {% set thumbnails = thumbnails + 1 %}
            {% else %}
                {% set listed = listed + 1 %}
            {% endif %}
        {% endfor %}
        
        {# Thumbnails are viewable files #}
        
        {% if thumbnails != 1 or listed > 0 %}
            {% include 'ColectaItemBundle:Default:itemDetails.html.twig' with { item: item } only %}
            
            {{ item.text | usercontent | striptags(allowed_tags) | cleancode | raw | nl2br }}
        {% endif %}
        
        {% if thumbnails == 1 and listed == 0 %} {# The folder consists of only one image #}
            <div class="row">
                <div class="col-xs-12 col-sm-9">
                    {% include 'ColectaItemBundle:Default:itemDetails.html.twig' with { item: item } only %}
                    
                    {{ item.text | usercontent | striptags(allowed_tags) | cleancode | raw | nl2br }}
                </div>
                
                <div class="preview col-xs-12 col-sm-3 ">
                    {% set file = files[0] %}
                    <a href="{{ path('ColectaFileView', { 'slug': file.slug }) }}"><img class="img-responsive" src="{{ path('ColectaFileThumbnail', {'slug':file.slug, 'width':200, 'height':200}) }}"></a>
                </div>
            </div>
        {% elseif thumbnails > 0 %}
            <div class="row thumbnails">        
                {% for file in files | slice(0,8) %}
                    {% if file.filetype in ['jpeg','gif','png'] %}                    
                        <div class="col-xs-6 col-sm-3">
                            <a href="{{ path('ColectaFileView', { 'slug': file.slug }) }}"><img class="img-responsive" src="{{ path('ColectaFileThumbnail', {'slug':file.slug, 'width':200, 'height':200}) }}"></a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
        
        {% if listed > 0 %}        
            <ul class="filelist list-group">
                {% for file in files %}
                    {% if file.filetype not in ['jpeg','gif','png'] %}
                        <li class="list-group-item"<i class="icon-file icon-2x"></i>
                            <strong><a href="{{ path('ColectaFileView', { 'slug': file.slug }) }}">{{ file.name }}</a></strong>
                            <a href="{{ path('ColectaFileDownload',{ 'slug': file.slug, 'type': file.filetype }) }}" class="btn btn-warning btn-xs pull-right"><i class="fa fa-download icon-large"></i> Descargar fichero <span style="text-transform: uppercase;">{{ file.filetype }}</span></a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% endif %}
        
        {% include 'ColectaItemBundle:Default:itemactions.html.twig' with { item: item } only %}
    </div>
    
    <div class="panel-footer">
        {% include 'ColectaItemBundle:Comment:comments.html.twig' with { 'comments': item.comments, 'item': item, 'collapse': 15 } only %}
    </div>
</div>

{% include 'ColectaItemBundle:Default:related.html.twig' with { 'items' : item.related } %}

{% endblock %}